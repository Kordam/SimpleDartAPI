#SimpleDartAPI

SimpleDartAPI is a Dart Framework that will allow you to easily create your own API in Dart.
This Framework is based on the [Express library](https://github.com/dartist/express) and allows you to create your route simply by configuring a YAML configuration file.

#Installation

To install SimpleDartAPI simply download the git repository :
```
 git clone git@github.com:Kordam/SimpleDartAPI.git
```
Then in [Dart Editor](https://www.dartlang.org/tools/editor/) run `pub get` (Tools -> Pub get) to get all the required packages to launch the server.

#Usage

The Framework is organized like this :

```
├── bin
│   ├── logs
│   │   ├── info.log
│   │   └── warning.log
│   ├── main.dart
│   └── src
│       ├── Controllers
│       │   ├── ControllersLibrary.dart
│       │   └── UserController.dart
│       ├── Router
│       │   ├── Middleware.dart
│       │   ├── NotFound.dart
│       │   ├── Response.dart
│       │   ├── Route.dart
│       │   └── Router.dart
│       └── Routes
│           └── 0.1
│               └── user.yaml
├── pubspec.lock
└── pubspec.yaml

```

## Logs

The `logs` directory will contains all the log generated by the server. Each request asked to the API is log as an info or a warning.
In the `info.log` are logged all the requests that receive the 200 status code and are therefore validate by the server.
In the `warning.log` are logged all the requests containing errors.

Each input in those files containe information about the request and the response (ip, route, method, etc ...)

## Main

Using the SimpleDartAPI Router is quite simple, here is the contain of **main.dart** :

```
import 'src/Router/Router.dart';

main(){
  Router router = new Router("/Routes/");
  router.launch("127.0.0.1", 8000);
}
```

First we include the Router class using the import keyword :
```
import 'src/Router/Router.dart';
```

We then create the Router itself by calling its constructor :
```
Router router = new Router("/Routes/");
```
The Router take as a parameter, the path to the routes of the versions' directory

Finaly we lauch the server on a specified host and port :
```
router.launch("127.0.0.1", 8000);
```

There you go, your API is up and running

## Routes

As said previously the SimpleDartAPI has a versioning system implemented.
Each version of your API is represented by a directory. The name of the directory represent the version number of your API.
Inside your version directory you can put all your route in multiple YAML file as so :

```
├── Routes
│   ├── 0.1
│   │   ├── User.yaml
│   │   └── Product.yaml
│   ├── 0.2
│       └── User.yaml
```

Here is an example of a routing file :
```
user_create:
  route: /user/create
  method: PUT
  action: User:create

user_get:
  route: /user/:userId/get
  method: GET
  action: User:get

user_edit:
  route: /user/:userId/edit
  method: POST
  action: User:edit
  needConnection: true

user_delete:
  route: /user/:userId/delete
  method: DELETE
  action: User:delete
```

This syntax is composed of 5 part:

1. **The route name (`user_create`)**: This name must be unique. It is the identifier of the route itself and is used in case of multiple version to automaticaly create the road for the higher version.

2. **The route URI (`route: /user/create`)**: This is the URI which will be accessible via the API. This will be prefixed by the version number of the API (directory name). For example the route `/user/create/` for the version *0.1* will become `/0.1/user/create/`.
The route are treated like in the Express plugin, to pass a GET parameter to the route you can use the syntax *:id* where *id* is the parameter retreived during the request treatment.

3. **The methods (`method: PUT`)**: This is the methods allowed to access the route. The treated method are *GET, POST, PUT, DELETE, ANY*. If you use the method *ANY*, the route can be access with any type of method. This value is applied by default if the line is not specified. 
You can defined multiple types of methods by separating them with the character *"|"* : `method: GET | POST `.

4. **The action (`action: User:create`)**: It is the action done when the request is treated by the Router. It is separated in two part :
   * `User` : Representing the controller containing the treatment function of the route.
   * `create` : The controller's function that will be called by the Router.

5. ** The need of connection (`needConnection: true`)**: Allows you to specify if the road need an identification to be accessed. You might need it to disallow pages in the *Middleware*. Default value is `false`.

## Middleware

SimpleDartAPI's Router has a MiddleWare functionality that is simply represented by a function call before each request treatment.
This function allows you to do pre-treament in order, for example, to check the access of certain pages according to the user privilege.
The Middleware is located in `src/Utility/Middleware`. its function *execute* is called before each request treatment.
The function *execute* take two parameters the context containing the Request itself and the Route informations contained in the configuration file.
If everything is OK then the function must return `false` otherwise it returns a Response object with the proper data and status code.

## Controllers

The Controllers are classes containing the functions called during the routing. Those class must be part of the **controllers** library defined in the `src/Controllers/ControllerLibrary.dart`. The name of a controller class is formated acording to the following rule: **controller_name** followed by the suffix *Controller*, for example the controller *User* must be called *UserController*.
To create a Controller you have to had it in the *controllers* library and name it as defined previously.

The controller contained function called during the routing, those functions are formated like this:
```
Response get(Map params) {
  String id = params["userId"];
  return new Response("Get User");
}
```
Those function take the parameter list from the request (GET / POST / PUT ...) as a map and returns a Response object.


## Responses

In order to uniformise the responses from the API a **Response** class has been create. This class is created from a dataset and a status code.

```dart
Response response = new Response("Not found", statusCode: 404);
```

The first parameter is the data sent back from the API. You can use any type of data (String, List, Map, int, etc...), the Response class will transform it to *JSON* to make it more easily usable for the client part.
The second parameter is optional and correspond to the status code send by the API. By default it is set to 200.
